<div class="movies-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">
        <i class="bi bi-film"></i>
        My Movies
      </h1>
      <p class="page-subtitle">Track your favorite films and movies</p>
    </div>
    <button class="add-button" routerLink="/layout/movies-new">
      <i class="bi bi-plus-circle"></i>
      Add New Movie
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading movies...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-state">
    <i class="bi bi-exclamation-triangle"></i>
    <p>{{ error }}</p>
    <button class="retry-button" (click)="loadMovies()">Try Again</button>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && !error && movies.length === 0" class="empty-state">
    <i class="bi bi-film"></i>
    <h3>No movies found</h3>
    <p>Start building your movie collection!</p>
  </div>

  <!-- Movies Grid -->
  <div *ngIf="!isLoading && !error && movies.length > 0" class="movies-grid content-grid" [class.rows-layout]="currentLayout === 'rows'">
    <div *ngFor="let movie of movies" 
         class="movie-card" 
         [class.expanded]="isMovieExpanded(movie.id)"
         (click)="toggleMovieExpansion(movie.id)">
      <div class="movie-card-body">
        <div class="movie-cover">
          <i class="bi bi-film"></i>
          <span class="movie-cover-letter">{{ movie.title.charAt(0) }}</span>
        </div>

        <div class="movie-info">
          <div class="movie-header">
            <div class="movie-title-section">
              <h3 class="movie-title">{{ movie.title }}</h3>
              <div class="movie-meta">
                <span class="movie-type">Movie</span>
                <span *ngIf="movie.genre" class="movie-genre">{{ movie.genre }}</span>
              </div>
            </div>
            <div class="movie-actions" (click)="$event.stopPropagation()">
              <button class="action-button expand" 
                      [title]="isMovieExpanded(movie.id) ? 'Collapse' : 'Expand'"
                      (click)="toggleMovieExpansion(movie.id, $event)">
                <i class="bi" [class.bi-chevron-down]="!isMovieExpanded(movie.id)" [class.bi-chevron-up]="isMovieExpanded(movie.id)"></i>
              </button>
              <button class="action-button edit" (click)="editMovie(movie.id)" title="Edit">
                <i class="bi bi-pencil"></i>
              </button>
              <button class="action-button delete" (click)="requestDelete(movie, $event)" title="Delete">
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </div>

          <div class="movie-summary">
            <div class="movie-director">
              <i class="bi bi-person"></i>
              <span>{{ movie.director }}</span>
            </div>
            <div class="movie-metrics" *ngIf="isMovieExpanded(movie.id)">
              <span *ngIf="movie.releaseYear" class="movie-metric">
                <i class="bi bi-calendar3"></i>
                {{ movie.releaseYear }}
              </span>
              <span *ngIf="movie.rating" class="movie-metric">
                <i class="bi bi-star-fill"></i>
                {{ movie.rating }}/5
              </span>
            </div>
          </div>
          
          <div class="movie-description" *ngIf="isMovieExpanded(movie.id)">
            <p>{{ movie.description }}</p>
          </div>
        </div>
      </div>

      <!-- Expanded Content -->
      <div class="movie-details" *ngIf="isMovieExpanded(movie.id)">
        <div class="detail-row" *ngIf="movie.notes">
          <i class="bi bi-sticky"></i>
          <div class="notes-content">
            <span class="detail-label">Notes:</span>
            <p class="detail-value notes">{{ movie.notes }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Results Count -->
  <div *ngIf="!isLoading && !error && movies.length > 0" class="results-info">
    <p>Showing {{ movies.length }} movie{{ movies.length === 1 ? '' : 's' }}</p>
  </div>

  <!-- Edit Modal -->
  <div id="modal" class="modal" [style.display]="modalVisible ? 'flex' : 'none'">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Edit Movie</h3>
        <button class="close-modal" (click)="closeModal()">×</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Title</label>
          <input class="form-input" type="text" [(ngModel)]="editTitle" required>
        </div>
        <div class="form-group">
          <label class="form-label">Description</label>
          <textarea class="form-textarea" [(ngModel)]="editDescription" rows="3" required></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Director</label>
            <input class="form-input" type="text" [(ngModel)]="editDirector" required>
          </div>
          <div class="form-group">
            <label class="form-label">Release Year</label>
            <input class="form-input" type="number" [(ngModel)]="editReleaseYear" min="1900" max="2030">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Genre</label>
            <select class="form-input" [(ngModel)]="editGenre">
              <option value="">Select Genre</option>
              <option value="Action">Action</option>
              <option value="Comedy">Comedy</option>
              <option value="Drama">Drama</option>
              <option value="Horror">Horror</option>
              <option value="Sci-Fi">Sci-Fi</option>
              <option value="Thriller">Thriller</option>
              <option value="Romance">Romance</option>
              <option value="Documentary">Documentary</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Rating</label>
            <select class="form-input" [(ngModel)]="editRating">
              <option value="">Select Rating</option>
              <option value="1">1 Star</option>
              <option value="2">2 Stars</option>
              <option value="3">3 Stars</option>
              <option value="4">4 Stars</option>
              <option value="5">5 Stars</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Notes</label>
          <textarea class="form-textarea" [(ngModel)]="editNotes" rows="2" placeholder="Additional notes about the movie..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeModal()">Cancel</button>
        <button class="btn btn-primary" (click)="saveEditedMovie()">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal confirm-modal" *ngIf="deleteTarget">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Delete Movie</h3>
        <button class="close-modal" (click)="cancelDelete()">×</button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete "<strong>{{ deleteTarget.title }}</strong>"? This action cannot be undone.</p>
      </div>
      <div class="modal-footer confirm-actions">
        <button class="btn btn-secondary" (click)="cancelDelete()">Cancel</button>
        <button class="btn btn-danger" (click)="confirmDelete()">Delete</button>
      </div>
    </div>
  </div>
</div>

