<div class="activities-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">
        <i class="bi bi-activity"></i>
        My Activities
      </h1>
      <p class="page-subtitle">Track and manage your personal activities</p>
    </div>
    <button class="add-button" (click)="toggleAddForm()">
      <i class="bi bi-plus-circle"></i>
      {{ showAddForm ? 'Close' : 'Add New Activity' }}
    </button>
  </div>

  <!-- Filters and Search -->
  <div class="filters-section">
    <div class="search-box">
      <i class="bi bi-search"></i>
      <input 
        type="text" 
        placeholder="Search activities..." 
        [(ngModel)]="searchTerm"
        (input)="onSearchChange()"
        class="search-input"
      >
    </div>
    
    <div class="filter-controls">
      <select 
        [(ngModel)]="selectedCategory" 
        (change)="onFilterChange()"
        class="filter-select"
      >
        <option value="all">All Categories</option>
        <option *ngFor="let category of categories" [value]="category">{{ category }}</option>
      </select>

      <select 
        [(ngModel)]="selectedStatus" 
        (change)="onFilterChange()"
        class="filter-select"
      >
        <option *ngFor="let status of statuses" [value]="status.value">{{ status.label }}</option>
      </select>

      <select 
        [(ngModel)]="selectedPriority" 
        (change)="onFilterChange()"
        class="filter-select"
      >
        <option *ngFor="let priority of priorities" [value]="priority.value">{{ priority.label }}</option>
      </select>
    </div>
  </div>

  <!-- Add Activity Form -->
  <div class="add-form-section" *ngIf="showAddForm">
    <div class="form-container">
      <h3 class="form-title">
        <i class="bi bi-plus-circle"></i>
        Add New Activity
      </h3>
      <form class="activity-form">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Title</label>
            <input class="form-input" type="text" [(ngModel)]="newTitle" name="title" required>
          </div>
          <div class="form-group">
            <label class="form-label">Category</label>
            <select class="form-input" [(ngModel)]="newCategory" name="category" required>
              <option value="">Select Category</option>
              <option value="Work">Work</option>
              <option value="Personal">Personal</option>
              <option value="Health">Health</option>
              <option value="Education">Education</option>
              <option value="Hobby">Hobby</option>
              <option value="Social">Social</option>
              <option value="Travel">Travel</option>
              <option value="Other">Other</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Description</label>
          <textarea class="form-textarea" [(ngModel)]="newDescription" name="description" rows="3" required placeholder="Describe your activity..."></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Date</label>
            <input class="form-input" type="date" [(ngModel)]="newDate" name="date" required>
          </div>
          <div class="form-group">
            <label class="form-label">Duration (minutes)</label>
            <input class="form-input" type="number" [(ngModel)]="newDuration" name="duration" min="1" placeholder="e.g., 60">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Status</label>
            <select class="form-input" [(ngModel)]="newStatus" name="status" required>
              <option value="">Select Status</option>
              <option value="planned">Planned</option>
              <option value="in-progress">In Progress</option>
              <option value="completed">Completed</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Priority</label>
            <select class="form-input" [(ngModel)]="newPriority" name="priority" required>
              <option value="">Select Priority</option>
              <option value="low">Low</option>
              <option value="medium">Medium</option>
              <option value="high">High</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Location</label>
          <input class="form-input" type="text" [(ngModel)]="newLocation" name="location" placeholder="Where will this take place?">
        </div>
        <div class="form-group">
          <label class="form-label">Tags</label>
          <input class="form-input" type="text" [(ngModel)]="newTags" name="tags" placeholder="work, urgent, meeting (comma-separated)">
        </div>
        <div class="form-group">
          <label class="form-label">Notes</label>
          <textarea class="form-textarea" [(ngModel)]="newNotes" name="notes" rows="2" placeholder="Additional notes or reminders..."></textarea>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="toggleAddForm()">Cancel</button>
          <button type="button" class="btn btn-primary" (click)="addActivity()">Add Activity</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading activities...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-state">
    <i class="bi bi-exclamation-triangle"></i>
    <p>{{ error }}</p>
    <button class="retry-button" (click)="loadActivities()">Try Again</button>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && !error && filteredActivities.length === 0" class="empty-state">
    <i class="bi bi-calendar-x"></i>
    <h3>No activities found</h3>
    <p>Start by adding your first activity!</p>
  </div>

  <!-- Activities Grid -->
  <div *ngIf="!loading && !error && filteredActivities.length > 0" class="activities-grid" [class.rows-layout]="currentLayout === 'rows'">
    <div *ngFor="let activity of filteredActivities" 
         class="activity-card" 
         [class.expanded]="isActivityExpanded(activity.id)"
         (click)="toggleActivityExpansion(activity.id)">
      <div class="activity-header">
        <div class="activity-title-section">
          <h3 class="activity-title">{{ activity.title }}</h3>
          <div class="activity-meta">
            <span class="activity-category">{{ activity.category }}</span>
            <span class="activity-date">{{ formatDate(activity.date) }}</span>
          </div>
        </div>
        <div class="activity-actions" (click)="$event.stopPropagation()">
          <button class="action-button expand" 
                  [title]="isActivityExpanded(activity.id) ? 'Collapse' : 'Expand'"
                  (click)="toggleActivityExpansion(activity.id, $event)">
            <i class="bi" [class.bi-chevron-down]="!isActivityExpanded(activity.id)" [class.bi-chevron-up]="isActivityExpanded(activity.id)"></i>
          </button>
          <button class="action-button edit" (click)="editActivity(activity)" title="Edit">
            <i class="bi bi-pencil"></i>
          </button>
          <button class="action-button delete" (click)="deleteActivity(activity)" title="Delete">
            <i class="bi bi-trash"></i>
          </button>
        </div>
      </div>

      <div class="activity-content">
        <p class="activity-description" [class.truncated]="!isActivityExpanded(activity.id)">
          {{ isActivityExpanded(activity.id) ? activity.description : truncateText(activity.description) }}
        </p>
        
        <div class="activity-details">
          <div class="detail-item">
            <i class="bi bi-flag"></i>
            <span class="status-badge" [class]="getStatusClass(activity.status)">
              {{ activity.status.replace('-', ' ') }}
            </span>
          </div>
          
          <div class="detail-item">
            <i class="bi bi-exclamation-circle"></i>
            <span class="priority-badge" [class]="getPriorityClass(activity.priority)">
              {{ activity.priority }}
            </span>
          </div>
          
          <div class="detail-item" *ngIf="activity.duration">
            <i class="bi bi-clock"></i>
            <span>{{ formatDuration(activity.duration) }}</span>
          </div>
          
          <div class="detail-item" *ngIf="activity.location">
            <i class="bi bi-geo-alt"></i>
            <span>{{ activity.location }}</span>
          </div>
        </div>

        <!-- Expanded Content -->
        <div class="activity-expanded-details" *ngIf="isActivityExpanded(activity.id)">
          <div class="detail-row" *ngIf="activity.tags && activity.tags.length > 0">
            <i class="bi bi-tags"></i>
            <span class="detail-label">Tags:</span>
            <div class="tags-container">
              <span *ngFor="let tag of activity.tags" class="tag">{{ tag }}</span>
            </div>
          </div>
          <div class="detail-row" *ngIf="activity.notes">
            <i class="bi bi-sticky"></i>
            <div class="notes-content">
              <span class="detail-label">Notes:</span>
              <p class="detail-value notes">{{ activity.notes }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Results Count -->
  <div *ngIf="!loading && !error && filteredActivities.length > 0" class="results-info">
    <p>Showing {{ filteredActivities.length }} of {{ activities.length }} activities</p>
  </div>

  <!-- Edit Modal -->
  <div id="modal" class="modal" [style.display]="modalVisible ? 'flex' : 'none'">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Edit Activity</h3>
        <button class="close-modal" (click)="closeModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Title</label>
          <input class="form-input" type="text" [(ngModel)]="editTitle" required>
        </div>
        <div class="form-group">
          <label class="form-label">Description</label>
          <textarea class="form-textarea" [(ngModel)]="editDescription" rows="3" required></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Category</label>
            <select class="form-input" [(ngModel)]="editCategory" required>
              <option *ngFor="let category of categories" [value]="category">{{ category }}</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Date</label>
            <input class="form-input" type="date" [(ngModel)]="editDate" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Status</label>
            <select class="form-input" [(ngModel)]="editStatus" required>
              <option *ngFor="let status of statuses" [value]="status.value">{{ status.label }}</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Priority</label>
            <select class="form-input" [(ngModel)]="editPriority" required>
              <option *ngFor="let priority of priorities" [value]="priority.value">{{ priority.label }}</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Duration (minutes)</label>
            <input class="form-input" type="number" [(ngModel)]="editDuration" min="0">
          </div>
          <div class="form-group">
            <label class="form-label">Location</label>
            <input class="form-input" type="text" [(ngModel)]="editLocation">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Tags (comma-separated)</label>
          <input class="form-input" type="text" [(ngModel)]="editTags" placeholder="tag1, tag2, tag3">
        </div>
        <div class="form-group">
          <label class="form-label">Notes</label>
          <textarea class="form-textarea" [(ngModel)]="editNotes" rows="2"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeModal()">Cancel</button>
        <button class="btn btn-primary" (click)="saveEditedActivity()">Save Changes</button>
      </div>
    </div>
  </div>
</div>
