<div class="diaries-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">
        <i class="bi bi-journal-text"></i>
        My Diaries
      </h1>
      <p class="page-subtitle">Capture your thoughts and memories</p>
    </div>
    <button class="add-button" (click)="toggleAddForm()">
      <i class="bi bi-plus-circle"></i>
      {{ showAddForm ? 'Close' : 'Add New Diary' }}
    </button>
  </div>

  <!-- Add Diary Form -->
  <div class="add-form-section" *ngIf="showAddForm">
    <div class="form-container">
      <h3 class="form-title">
        <i class="bi bi-plus-circle"></i>
        Add New Diary Entry
      </h3>
      <form class="diary-form">
        <div class="form-group">
          <label class="form-label">Title</label>
          <input class="form-input" type="text" [(ngModel)]="newTitle" name="title" required>
        </div>
        <div class="form-group">
          <label class="form-label">Entry</label>
          <textarea class="form-textarea" [(ngModel)]="newBody" name="body" rows="6" required placeholder="Write your diary entry here..."></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Date</label>
            <input class="form-input" type="date" [(ngModel)]="newDate" name="date" required>
          </div>
          <div class="form-group">
            <label class="form-label">Mood</label>
            <select class="form-input" [(ngModel)]="newMood" name="mood">
              <option value="">Select Mood</option>
              <option value="ğŸ˜Š Happy">ğŸ˜Š Happy</option>
              <option value="ğŸ˜¢ Sad">ğŸ˜¢ Sad</option>
              <option value="ğŸ˜Œ Calm">ğŸ˜Œ Calm</option>
              <option value="ğŸ˜¤ Angry">ğŸ˜¤ Angry</option>
              <option value="ğŸ˜° Anxious">ğŸ˜° Anxious</option>
              <option value="ğŸ¤” Thoughtful">ğŸ¤” Thoughtful</option>
              <option value="ğŸ˜´ Tired">ğŸ˜´ Tired</option>
              <option value="ğŸ‰ Excited">ğŸ‰ Excited</option>
              <option value="ğŸ˜” Melancholy">ğŸ˜” Melancholy</option>
              <option value="ğŸ˜Œ Content">ğŸ˜Œ Content</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Weather</label>
            <select class="form-input" [(ngModel)]="newWeather" name="weather">
              <option value="">Select Weather</option>
              <option value="â˜€ï¸ Sunny">â˜€ï¸ Sunny</option>
              <option value="â›… Partly Cloudy">â›… Partly Cloudy</option>
              <option value="â˜ï¸ Cloudy">â˜ï¸ Cloudy</option>
              <option value="ğŸŒ§ï¸ Rainy">ğŸŒ§ï¸ Rainy</option>
              <option value="â›ˆï¸ Stormy">â›ˆï¸ Stormy</option>
              <option value="â„ï¸ Snowy">â„ï¸ Snowy</option>
              <option value="ğŸŒ¤ï¸ Clear">ğŸŒ¤ï¸ Clear</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Location</label>
            <input class="form-input" type="text" [(ngModel)]="newLocation" name="location" placeholder="Where are you writing from?">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Tags</label>
          <input class="form-input" type="text" [(ngModel)]="newTags" name="tags" placeholder="work, family, travel, reflection (comma-separated)">
        </div>
        <div class="form-group">
          <label class="form-label">Private Notes</label>
          <textarea class="form-textarea" [(ngModel)]="newPrivateNotes" name="privateNotes" rows="2" placeholder="Additional private thoughts or reminders..."></textarea>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="toggleAddForm()">Cancel</button>
          <button type="button" class="btn btn-primary" (click)="addDiary()">Add Entry</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading diary entries...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-state">
    <i class="bi bi-exclamation-triangle"></i>
    <p>{{ error }}</p>
    <button class="retry-button" (click)="loadDiaries()">Try Again</button>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && !error && diaries.length === 0" class="empty-state">
    <i class="bi bi-journal-text"></i>
    <h3>No diary entries found</h3>
    <p>Start writing your first diary entry!</p>
  </div>

  <!-- Diaries Grid -->
  <div *ngIf="!isLoading && !error && diaries.length > 0" class="diaries-grid" [class.rows-layout]="currentLayout === 'rows'">
    <div *ngFor="let diary of diaries" 
         class="diary-card" 
         [class.expanded]="isDiaryExpanded(diary.id)"
         (click)="toggleDiaryExpansion(diary.id)">
      <div class="diary-header">
        <div class="diary-title-section">
          <h3 class="diary-title">{{ diary.title }}</h3>
          <div class="diary-meta">
            <span class="diary-type">Diary</span>
            <span class="diary-date" *ngIf="diary.createdAt">
              <i class="bi bi-clock"></i>
              {{ diary.createdAt | date:'medium' }}
            </span>
          </div>
        </div>
        <div class="diary-actions" (click)="$event.stopPropagation()">
          <button class="action-button expand" 
                  [title]="isDiaryExpanded(diary.id) ? 'Collapse' : 'Expand'"
                  (click)="toggleDiaryExpansion(diary.id, $event)">
            <i class="bi" [class.bi-chevron-down]="!isDiaryExpanded(diary.id)" [class.bi-chevron-up]="isDiaryExpanded(diary.id)"></i>
          </button>
          <button class="action-button edit" (click)="editDiary(diary.id)" title="Edit">
            <i class="bi bi-pencil"></i>
          </button>
          <button class="action-button delete" (click)="deleteDiary(diary.id)" title="Delete">
            <i class="bi bi-trash"></i>
          </button>
        </div>
      </div>

      <div class="diary-content">
        <div class="diary-body">
          <p [class.truncated]="!isDiaryExpanded(diary.id)">
            {{ isDiaryExpanded(diary.id) ? diary.body : truncateText(diary.body) }}
          </p>
        </div>

        <!-- Expanded Content -->
        <div class="diary-details" *ngIf="isDiaryExpanded(diary.id)">
          <div class="detail-row" *ngIf="diary.date">
            <i class="bi bi-calendar"></i>
            <span class="detail-label">Date:</span>
            <span class="detail-value">{{ diary.date }}</span>
          </div>
          <div class="detail-row" *ngIf="diary.mood">
            <i class="bi bi-emoji-smile"></i>
            <span class="detail-label">Mood:</span>
            <span class="detail-value">{{ diary.mood }}</span>
          </div>
          <div class="detail-row" *ngIf="diary.weather">
            <i class="bi bi-cloud"></i>
            <span class="detail-label">Weather:</span>
            <span class="detail-value">{{ diary.weather }}</span>
          </div>
          <div class="detail-row" *ngIf="diary.location">
            <i class="bi bi-geo-alt"></i>
            <span class="detail-label">Location:</span>
            <span class="detail-value">{{ diary.location }}</span>
          </div>
          <div class="detail-row" *ngIf="diary.tags && diary.tags.length > 0">
            <i class="bi bi-tags"></i>
            <span class="detail-label">Tags:</span>
            <div class="tags-container">
              <span *ngFor="let tag of diary.tags" class="tag">{{ tag }}</span>
            </div>
          </div>
          <div class="detail-row" *ngIf="diary.privateNotes">
            <i class="bi bi-lock"></i>
            <div class="notes-content">
              <span class="detail-label">Private Notes:</span>
              <p class="detail-value notes">{{ diary.privateNotes }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Results Count -->
  <div *ngIf="!isLoading && !error && diaries.length > 0" class="results-info">
    <p>Showing {{ diaries.length }} entr{{ diaries.length === 1 ? 'y' : 'ies' }}</p>
  </div>

  <!-- Edit Modal -->
  <div id="modal" class="modal" [style.display]="modalVisible ? 'flex' : 'none'">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Edit Diary Entry</h3>
        <button class="close-modal" (click)="closeModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Title</label>
          <input class="form-input" type="text" [(ngModel)]="editTitle" required>
        </div>
        <div class="form-group">
          <label class="form-label">Entry</label>
          <textarea class="form-textarea" [(ngModel)]="editBody" rows="6" required placeholder="Write your diary entry here..."></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Date</label>
            <input class="form-input" type="date" [(ngModel)]="editDate" required>
          </div>
          <div class="form-group">
            <label class="form-label">Mood</label>
            <select class="form-input" [(ngModel)]="editMood">
              <option value="">Select Mood</option>
              <option value="ğŸ˜Š Happy">ğŸ˜Š Happy</option>
              <option value="ğŸ˜¢ Sad">ğŸ˜¢ Sad</option>
              <option value="ğŸ˜Œ Calm">ğŸ˜Œ Calm</option>
              <option value="ğŸ˜¤ Angry">ğŸ˜¤ Angry</option>
              <option value="ğŸ˜° Anxious">ğŸ˜° Anxious</option>
              <option value="ğŸ¤” Thoughtful">ğŸ¤” Thoughtful</option>
              <option value="ğŸ˜´ Tired">ğŸ˜´ Tired</option>
              <option value="ğŸ‰ Excited">ğŸ‰ Excited</option>
              <option value="ğŸ˜” Melancholy">ğŸ˜” Melancholy</option>
              <option value="ğŸ˜Œ Content">ğŸ˜Œ Content</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Weather</label>
            <select class="form-input" [(ngModel)]="editWeather">
              <option value="">Select Weather</option>
              <option value="â˜€ï¸ Sunny">â˜€ï¸ Sunny</option>
              <option value="â›… Partly Cloudy">â›… Partly Cloudy</option>
              <option value="â˜ï¸ Cloudy">â˜ï¸ Cloudy</option>
              <option value="ğŸŒ§ï¸ Rainy">ğŸŒ§ï¸ Rainy</option>
              <option value="â›ˆï¸ Stormy">â›ˆï¸ Stormy</option>
              <option value="â„ï¸ Snowy">â„ï¸ Snowy</option>
              <option value="ğŸŒ¤ï¸ Clear">ğŸŒ¤ï¸ Clear</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Location</label>
            <input class="form-input" type="text" [(ngModel)]="editLocation" placeholder="Where are you writing from?">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Tags</label>
          <input class="form-input" type="text" [(ngModel)]="editTags" placeholder="work, family, travel, reflection (comma-separated)">
        </div>
        <div class="form-group">
          <label class="form-label">Private Notes</label>
          <textarea class="form-textarea" [(ngModel)]="editPrivateNotes" rows="2" placeholder="Additional private thoughts or reminders..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeModal()">Cancel</button>
        <button class="btn btn-primary" (click)="saveEditedDiary()">Save Changes</button>
      </div>
    </div>
  </div>
</div>

